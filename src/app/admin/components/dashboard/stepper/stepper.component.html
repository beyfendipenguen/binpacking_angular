<ng-container *ngIf="vm$ | async as vm">
  <mat-stepper
    #stepper
    class="responsive-stepper"
    [linear]="!vm.isEditMode"
    [orientation]="(stepperOrientation | async)!"
    [selectedIndex]="selectedIndex"
    (selectionChange)="onStepChange($event)"
  >
    <app-loading></app-loading>

    <mat-step [completed]="getStepCompleted(0)" [editable]="getStepEditable(0)">
      <ng-template matStepLabel>
        (ISB) ƒ∞hracat Sipari≈ü Bildirimi Y√ºkleme @if (vm.isEditMode) {<span
          class="edit-mode-badge"
          >D√úZENLEME</span
        >}
      </ng-template>

      <app-invoice-upload
        #invoiceUploadComponent
        (invoiceUploaded)="invoiceUploaded()"
        (configurePallet)="configureEditModeInPalletComponent()"
      >
      </app-invoice-upload>
    </mat-step>

    <mat-step [completed]="getStepCompleted(1)" [editable]="getStepEditable(1)">
      <ng-template matStepLabel>
        Palet Kontrol√º @if (vm.isEditMode) {<span class="edit-mode-badge"
          >D√úZENLEME</span
        >}
      </ng-template>

      @if (selectedIndex === 1 || vm.isEditMode) {
      <app-pallet-control #palletControlComponent> </app-pallet-control>
      }
    </mat-step>

    <mat-step [completed]="getStepCompleted(2)" [editable]="getStepEditable(2)">
      <ng-template matStepLabel>
        Sonu√ß Ekranƒ± @if (vm.isEditMode) {<span class="edit-mode-badge"
          >D√úZENLEME</span
        >}
      </ng-template>

      @if (selectedIndex === 2 || vm.isEditMode) {
      <app-result-step
        #resultStepComponent
        (shipmentCompleted)="onShipmentCompleted()"
      >
      </app-result-step
      >}
    </mat-step>
  </mat-stepper>

  @if(true){
  <ng-container>
    <div class="debug-info">
      <h4>üêõ Debug Info (Performance Optimized)</h4>
      <p><strong>Current Step:</strong> {{ vm.currentStep }}</p>
      <p><strong>Edit Mode:</strong> {{ vm.isEditMode }}</p>
      <p><strong>Edit Order ID:</strong> {{ vm.editOrderId }}</p>
      <p>
        <strong>Progress:</strong> {{ vm.stepperSummary.progressPercentage }}%
      </p>
      <p>
        <strong>Completed Steps:</strong>
        {{ vm.stepperSummary.completedSteps | json }}
      </p>
    </div>
  </ng-container>

  }
</ng-container>

@if (!(vm$ | async)) {
<ng-container>
  <div class="stepper-loading">
    <app-loading></app-loading>
    <p>Stepper hazƒ±rlanƒ±yor...</p>
  </div>
</ng-container>
}

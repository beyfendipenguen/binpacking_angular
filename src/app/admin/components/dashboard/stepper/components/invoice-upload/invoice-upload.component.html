<div class="logistics-container">
  <!-- Page Header -->
  <div class="logistics-header">
    <div class="header-icon">
      <mat-icon>assignment</mat-icon>
    </div>
    <div class="header-titles">
      <h1>İhracat Sipariş Bildirimi</h1>
      <p class="header-subtitle">Siparişlerin detaylarını yönetin ve takip edin</p>
    </div>
  </div>

  <!-- Empty State Card -->
  <div class="logistics-card" *ngIf="!order && !isLoading">
    <div class="empty-state">
      <div class="empty-icon">
        <mat-icon>description</mat-icon>
      </div>
      <h3>Sipariş Bilgisi Bulunamadı</h3>
      <p>Mevcut bir sipariş bilgisi bulunmuyor. Excel dosyası yükleyebilir veya manuel olarak sipariş detayı ekleyebilirsiniz.</p>

      <div class="action-options">
        <button mat-raised-button class="action-button" (click)="createOrderDetail()">
          <mat-icon>add</mat-icon>
          <span>Manuel Giriş</span>
        </button>

        <div class="divider">
          <span>veya</span>
        </div>

        <div class="file-upload-container">
          <button mat-raised-button class="action-button secondary" (click)="fileInput.click()" [disabled]="excelUpload">
            <mat-icon>file_upload</mat-icon>
            <span>{{ file?.name || "Excel Dosyası Seç" }}</span>
          </button>
          <input (change)="onFileSelected($event)" #fileInput type="file" accept=".pdf,.xls,.xlsx" hidden />

          <button *ngIf="file" mat-raised-button class="upload-button" [disabled]="!file || excelUpload" (click)="uploadFile()">
            <mat-icon>cloud_upload</mat-icon>
            <span>İçeri Aktar</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-content">
      <div class="animated-icon">
        <mat-icon>local_shipping</mat-icon>
        <div class="loading-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
      <p>Sipariş verileri yükleniyor...</p>
    </div>
  </div>

  <!-- Order Details Dashboard -->
  <div *ngIf="order && !isLoading" class="details-section">
    <!-- Order Summary -->
    <div class="dashboard-panel">
  <!-- Sipariş No -->
  <div class="dashboard-item">
    <div class="dashboard-icon">
      <mat-icon>receipt</mat-icon>
    </div>
    <div class="dashboard-info">
      <span class="dashboard-label">Sipariş No</span>
      <div class="dashboard-value-container">
        <span *ngIf="!editMode.orderName" class="dashboard-value">{{order.name || 'N/A'}}</span>
        <mat-form-field *ngIf="editMode.orderName" class="edit-field" appearance="outline">
          <input matInput [(ngModel)]="editableOrder.name" placeholder="Sipariş No">
        </mat-form-field>
      </div>
    </div>
    <div class="dashboard-actions">
      <button *ngIf="!editMode.orderName" mat-icon-button (click)="toggleEditMode('orderName')" matTooltip="Düzenle">
        <mat-icon>edit</mat-icon>
      </button>
      <div *ngIf="editMode.orderName" class="action-buttons">
        <button mat-icon-button (click)="saveField('orderName')" matTooltip="Kaydet" class="save-btn">
          <mat-icon>check</mat-icon>
        </button>
        <button mat-icon-button (click)="cancelEdit('orderName')" matTooltip="İptal" class="cancel-btn">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Sipariş Tarihi -->
  <div class="dashboard-item">
    <div class="dashboard-icon">
      <mat-icon>event</mat-icon>
    </div>
    <div class="dashboard-info">
      <span class="dashboard-label">Sipariş Tarihi</span>
      <div class="dashboard-value-container">
        <span *ngIf="!editMode.orderDate" class="dashboard-value">{{getFormattedDate(order.date)}}</span>
        <mat-form-field *ngIf="editMode.orderDate" class="edit-field" appearance="outline">
          <input matInput [matDatepicker]="picker" [(ngModel)]="editableOrder.date" placeholder="Tarih seçin">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </div>
    </div>
    <div class="dashboard-actions">
      <button *ngIf="!editMode.orderDate" mat-icon-button (click)="toggleEditMode('orderDate')" matTooltip="Düzenle">
        <mat-icon>edit</mat-icon>
      </button>
      <div *ngIf="editMode.orderDate" class="action-buttons">
        <button mat-icon-button (click)="saveField('orderDate')" matTooltip="Kaydet" class="save-btn">
          <mat-icon>check</mat-icon>
        </button>
        <button mat-icon-button (click)="cancelEdit('orderDate')" matTooltip="İptal" class="cancel-btn">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Müşteri -->
  <div class="dashboard-item">
    <div class="dashboard-icon">
      <mat-icon>business</mat-icon>
    </div>
    <div class="dashboard-info">
      <span class="dashboard-label">Müşteri</span>
      <div class="dashboard-value-container">
        <span *ngIf="!editMode.customer" class="dashboard-value">{{order.company_relation.target_company_name}}</span>
        <mat-form-field *ngIf="editMode.customer" class="edit-field" appearance="outline">
          <mat-select [(ngModel)]="editableOrder.company_relation_id" placeholder="Müşteri seçin">
            <mat-option *ngFor="let company of targetCompanies" [value]="company.id">
              {{company.target_company_name}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div class="dashboard-actions">
      <button *ngIf="!editMode.customer" mat-icon-button (click)="toggleEditMode('customer')" matTooltip="Düzenle">
        <mat-icon>edit</mat-icon>
      </button>
      <div *ngIf="editMode.customer" class="action-buttons">
        <button mat-icon-button (click)="saveField('customer')" matTooltip="Kaydet" class="save-btn">
          <mat-icon>check</mat-icon>
        </button>
        <button mat-icon-button (click)="cancelEdit('customer')" matTooltip="İptal" class="cancel-btn">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>
  </div>
</div>

    <!-- Order Details Table -->
    <div class="logistics-card">
      <div class="section-header with-action">
        <div class="header-title">
          <mat-icon>list_alt</mat-icon>
          <h2>Sipariş Detayları</h2>
        </div>
      </div>

      <div class="table-container">
        <app-generic-table [externalData]="orderDetails"
                          [externalTotalCount]="orderDetails.length"
                          [displayedColumns]="displayedColumns"
                          [filterableColumns]="filterableColumns"
                          [nestedDisplayColumns]="nestedDisplayColumns"
                          [parentId]="order.id"
                          [useParentId]="true"
                          [parentIdFieldName]="'order_id'"
                          [title]="''"
                          [showRowNumbers]="true"
                          (addClick)="createOrderDetail()"
                          (externalDataUpdate)="updateOrderDetail($event)"
                          (externalDataDelete)="deleteOrderDetail($event)"
                          [excludeFields]="excludeFields">
        </app-generic-table>
      </div>

      <div class="summary-footer" *ngIf="orderDetails && orderDetails.length > 0">
        <div class="summary-content">
          <div class="summary-metrics">
            <div class="metric">
              <mat-icon>inventory_2</mat-icon>
              <span>{{orderDetails.length}} Kalem</span>
            </div>
            <div class="metric">
              <mat-icon>scale</mat-icon>
              <span>{{totalWeight.toFixed(2)}} kg</span>
            </div>
          </div>
          <button mat-raised-button class="save-button" [disabled]="false" (click)="submit()">
            <mat-icon>save</mat-icon>
            <span>Kaydet</span>
          </button>
          <div class="status-badge">
            <span class="status-dot active"></span>
            <span>Aktif</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation Controls -->
  <div class="navigation-controls">
    <button mat-raised-button class="next-button" matStepperNext [disabled]="!order">
      <span>Sonraki Adım</span>
      <mat-icon>arrow_forward</mat-icon>
    </button>
  </div>
</div>

<div class="isb-container">
  <!-- Page Header -->
  <div class="isb-header">
    <h2 class="mat-h2">İhracat Sipariş Bildirimi (ISB)</h2>
    <mat-divider></mat-divider>
  </div>

  <!-- Empty State Card -->
  <mat-card *ngIf="!order && !isLoading" class="isb-card">
    <mat-card-content>
      <div class="empty-state">
        <mat-icon class="info-icon">description</mat-icon>
        <h3 class="mat-h3">Sipariş Bilgisi Yok</h3>
        <p>Henüz sipariş bilgisi yok. Excel dosyası yükleyebilir veya manuel olarak sipariş detayı ekleyebilirsiniz.</p>

        <div class="action-buttons">
          <button mat-raised-button class="primary-button" (click)="addOrderDetail()" [disabled]="manualAdd">
            <mat-icon>add</mat-icon> Sipariş Detayı Ekle
          </button>

          <div class="divider-text">ya da</div>

          <button mat-raised-button class="primary-button file-select-button" (click)="fileInput.click()"
            [disabled]="excelUpload">
            <mat-icon>cloud_upload</mat-icon> {{ file?.name || "Dosya Seç" }}
          </button>
          <input (change)="onFileSelected($event)" #fileInput type="file" accept=".pdf,.xls,.xlsx" hidden />
        </div>

        <button *ngIf="file" mat-flat-button class="accent-button upload-button" [disabled]="!file || excelUpload"
          (click)="uploadFile()">
          <mat-icon>upload_file</mat-icon> İçeri Aktar
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Loading Indicator -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-card>
      <mat-card-content class="loading-content">
        <mat-spinner color="accent" diameter="40"></mat-spinner>
        <p>Yükleniyor...</p>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Order Details Table -->
  <div *ngIf="order && !isLoading" class="details-container">
    <div class="package-info">
      <!-- <p><mat-icon>description</mat-icon> Sipariş No: {{order.orderNumber || 'N/A'}}</p> -->
      <p><mat-icon>date_range</mat-icon> Tarih: {{getFormattedDate(order.date)}}</p>
      <p><mat-icon>business</mat-icon> Müşteri: {{order.company?.company_name || 'N/A'}}</p>
    </div>

    <mat-card>

      <mat-card-content>
        <app-generic-table [service]="orderDetailService" [displayedColumns]="displayedColumns"
          [filterableColumns]="filterableColumns" [nestedDisplayColumns]="nestedDisplayColumns" [parentId]="order.id"
          [useParentId]="true" [parentIdFieldName]="'order_id'" [title]="''" [showRowNumbers]="true"
          (addClick)="addOrderDetail()" (updateItem)="onTableUpdate($event)" [excludeFields]="excludeFields">
        </app-generic-table>
      </mat-card-content>

      <div class="pallet-footer" *ngIf="orderDetails && orderDetails.length > 0">
        <div class="footer-content">
          <div class="pallet-summary">
            <div class="summary-item">
              <mat-icon class="icon-display">inventory_2</mat-icon>
              <span>{{orderDetails.length}} Kalem</span>
            </div>
            <div class="summary-item">
              <mat-icon class="icon-display">scale</mat-icon>
              <span>{{totalWeight.toFixed(2)}} kg</span>
            </div>
          </div>
        </div>
      </div>
    </mat-card>
  </div>

  <!-- Navigation Buttons -->
  <div class="navigation-buttons">
    <button mat-button class="primary-button" matStepperNext [disabled]="!order">
      <span>İleri</span>
      <mat-icon>arrow_forward</mat-icon>
    </button>
  </div>
</div>

<div class="order-detail-dialog-container">
  <div class="dialog-header">
    <div class="icon-wrapper">
      <mat-icon class="header-icon">add_shopping_cart</mat-icon>
    </div>
    <h2 mat-dialog-title>{{ 'INVOICE_UPLOAD.ADD_ORDER_DETAIL' | translate }}</h2>
  </div>

  <mat-dialog-content>
    <form [formGroup]="orderDetailForm" (ngSubmit)="onSubmit()">
      <!-- Ürün Arama -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ 'INVOICE_UPLOAD.SEARCH_PRODUCT' | translate }}</mat-label>
        <mat-icon matPrefix>inventory_2</mat-icon>
        <input type="text" [placeholder]="'INVOICE_UPLOAD.SEARCH_PLACEHOLDER' | translate" matInput
          formControlName="product" [matAutocomplete]="auto">
        <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayProductFn.bind(this)">
          @if(isLoading) {
            <mat-option class="loading-indicator">
              <mat-spinner diameter="20"></mat-spinner>
              <span>{{ 'COMMON.SEARCHING' | translate }}</span>
            </mat-option>
          }

          @if(hasError) {
            <mat-option class="error-message">
              <mat-icon>error_outline</mat-icon>
              <span class="error-text">{{ errorMessage }}</span>
            </mat-option>
          }

          @if(!isLoading && !hasError) {
            @if(filteredProducts.length === 0) {
              <mat-option disabled>
                <mat-icon>search_off</mat-icon>
                <span>{{ 'PALLET.NO_RESULTS' | translate }}</span>
              </mat-option>
            }
            @for(product of filteredProducts; track product.id) {
              <mat-option [value]="product" (click)="selectProduct(product)">
                <div class="product-option">
                  <mat-icon>inventory</mat-icon>
                  <span>{{ product.name }}</span>
                </div>
              </mat-option>
            }
          }
        </mat-autocomplete>
        <mat-hint>{{ 'INVOICE_UPLOAD.MIN_CHARS' | translate }}</mat-hint>
      </mat-form-field>

      <!-- Miktar -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ 'INVOICE_UPLOAD.QUANTITY' | translate }}</mat-label>
        <mat-icon matPrefix>numbers</mat-icon>
        <input type="number" matInput formControlName="count" min="1">
        @if(orderDetailForm.get('count')?.hasError('required')) {
          <mat-error>{{ 'INVOICE_UPLOAD.QUANTITY_REQUIRED' | translate }}</mat-error>
        }
        @if(orderDetailForm.get('count')?.hasError('min')) {
          <mat-error>{{ 'INVOICE_UPLOAD.QUANTITY_MIN' | translate }}</mat-error>
        }
      </mat-form-field>

      <!-- Seçilen Ürün Bilgisi -->
      @if(orderDetailForm.get('product_id')?.value && orderDetailForm.get('product_id')?.value.id) {
        <div class="selected-product-box">
          <div class="product-header">
            <mat-icon>check_circle</mat-icon>
            <h4>{{ 'INVOICE_UPLOAD.SELECTED_PRODUCT' | translate }}</h4>
          </div>
          <div class="product-details">
            <div class="product-detail-item">
              <mat-icon>qr_code_2</mat-icon>
              <div class="detail-content">
                <span class="detail-label">{{ 'INVOICE_UPLOAD.CODE_TYPE' | translate }}</span>
                <span class="detail-value">
                  {{ orderDetailForm.get('product_id')?.value.product_type?.code }}-{{
                  orderDetailForm.get('product_id')?.value.product_type?.type }}
                </span>
              </div>
            </div>
            <div class="product-detail-item">
              <mat-icon>straighten</mat-icon>
              <div class="detail-content">
                <span class="detail-label">{{ 'TRUCK_VISUALIZATION.DIMENSIONS' | translate }}</span>
                <span class="detail-value">
                  {{ orderDetailForm.get('product_id')?.value.dimension?.width }}x
                  {{ orderDetailForm.get('product_id')?.value.dimension?.height }}x
                  {{ orderDetailForm.get('product_id')?.value.dimension?.depth }}
                  {{ orderDetailForm.get('product_id')?.value.dimension?.unit }}
                </span>
              </div>
            </div>
            <div class="product-detail-item">
              <mat-icon>analytics</mat-icon>
              <div class="detail-content">
                <span class="detail-label">{{'DIMENSIONS.VOLUME' | translate}}:</span>
                <span class="detail-value">
                  {{ orderDetailForm.get('product_id')?.value.dimension?.volume | number:'1.0-2' }} mm³
                </span>
              </div>
            </div>
          </div>
        </div>
      }
    </form>
  </mat-dialog-content>

  <mat-dialog-actions>
    <button mat-stroked-button (click)="onCancel()" class="cancel-button">
      <mat-icon>close</mat-icon>
      <span>{{ 'HEADER.CANCEL' | translate }}</span>
    </button>
    <button mat-raised-button color="primary" [disabled]="orderDetailForm.invalid"
      (click)="onSubmit()" class="save-button">
      <mat-icon>save</mat-icon>
      <span>{{ 'COMMON.SAVE' | translate }}</span>
    </button>
  </mat-dialog-actions>
</div>

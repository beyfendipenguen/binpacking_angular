<div class="table-container mat-elevation-z8">
  <div class="table-header">
    <h2>{{ title | translate }}</h2>
    <div class="spacer"></div>

    <!-- Aktif filtreleri temizleme butonu -->
    @if (hasActiveFilters()) {
    <button mat-button color="primary" (click)="clearAllFilters()">
      <mat-icon>filter_list_off</mat-icon>{{ 'GENERIC_TABLE.CLEAR_FILTERS' | translate }}</button>
    }
  </div>

  <!-- Loading indicator -->
  @if (isLoading) {
  <div class="loading-shade">
    <mat-spinner></mat-spinner>
  </div>
  }

  <!-- Aktif filtreler -->
  @if (hasActiveFilters()) {
  <div class="active-filters">
    <div class="chip-list">
      <span class="filter-label">{{ 'GENERIC_TABLE.ACTIVE_FILTERS' | translate }}</span>

      <!-- Her aktif filtre için çip -->
      @for (column of filterableColumns; track column) { @if
      (isFilterActive(column)) {
      <div class="filter-chip">
        <span class="chip-label">
          {{ getColumnDisplayName(column) }}: {{ filterValues[column] }}
        </span>
        <button
          mat-icon-button
          class="chip-remove"
          (click)="filterValues[column] = ''; loadData()"
        >
          <mat-icon>close</mat-icon>
        </button>
      </div>
      } }
    </div>
  </div>
  }

  <!-- Table -->
  <table mat-table [dataSource]="dataSource" matSort matSortDisableClear>
    <ng-container matColumnDef="rowNumber">
      <th mat-header-cell *matHeaderCellDef class="text-center">
        @if (showAddButton) {
        <button
          mat-icon-button
          (click)="onAddButtonClick($event)"
          [matTooltip]="'GENERIC_TABLE.ADD_NEW' | translate"
        >
          <mat-icon>add_circle</mat-icon>
        </button>
        }
      </th>
      <td mat-cell *matCellDef="let row; let i = index" class="row-number-cell">
        {{ getRowNumber(i) }}
      </td>
    </ng-container>

    <!-- Dynamic Columns -->
    @for (column of displayedColumns; track column) {
    <ng-container [matColumnDef]="column">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        <div class="header-content">
          {{ getColumnDisplayName(column) }}

          <!-- Filtre ikonu -->
          @if (filterableColumns.includes(column)) {
          <button
            mat-icon-button
            class="filter-icon"
            [class.active-filter]="isFilterActive(column)"
            (click)="openFilterDialog(column, $event)"
            [matTooltip]="
              (isFilterActive(column) ? 'GENERIC_TABLE.EDIT_FILTER' : 'GENERIC_TABLE.FILTER') | translate
            "
          >
            <mat-icon>filter_alt</mat-icon>
          </button>
          }
        </div>
      </th>

      <td
        mat-cell
        *matCellDef="let row"
        [class.numeric-cell]="
          !isButtonColumn(column) &&
          isNumeric(getNestedPropertyValue(row, column))
        "
        [class.button-cell]="isButtonColumn(column)"
      >
        <!-- Button Column Template -->
        @if (isButtonColumn(column)) { @if (getButtonConfig(column); as
        btnConfig) {
        <button
          mat-icon-button
          [color]="btnConfig.color || 'primary'"
          [matTooltip]="btnConfig.tooltip || ''"
          [class]="btnConfig.class || ''"
          (click)="onCellButtonClick(row, column, $event)"
        >
          <mat-icon>{{ btnConfig.icon || "more_vert" }}</mat-icon>
          @if (btnConfig.text) {
          <span class="button-text">{{ btnConfig.text }}</span>
          }
        </button>
        } } @else if (columnTypes[column] === 'status') {
          <div class="status-container">
            @if (row[column] === true) {
              <span class="status-indicator status-success"></span>
              <span class="status-text status-success-text">{{ 'COMMON.COMPLETED' | translate }}</span>
            } @else {
              <span class="status-indicator status-warning"></span>
              <span class="status-text status-warning-text">{{ 'ORDER.INCOMPLETE_ORDER' | translate }}</span>
            }
          </div>
        } @else {
        <!-- Regular Cell Content -->
        <span>{{ getNestedPropertyValue(row, column) }}</span>
        }
      </td>
    </ng-container>
    }

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>{{ 'MENU.OPERATIONS' | translate }}</th>
      <td mat-cell *matCellDef="let row">
        <div class="action-buttons">
          @if (showDeleteButton) {
          <button
            class="btn"
            mat-icon-button
            color="warn"
            (click)="confirmDelete(row.id); $event.stopPropagation()"
            [matTooltip]="'COMMON.DELETE'| translate"
          >
            <mat-icon>delete</mat-icon>
          </button>
          } @if (showUpdateButton) {
          <button
            class="btn"
            mat-icon-button
            (click)="openAddOrUpdateDialog(row); $event.stopPropagation()"
            matTooltip="'COMMON.UPDATE'| translate"
          >
            <mat-icon>update</mat-icon>
          </button>
          }
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="getDisplayColumnWithActions()"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: getDisplayColumnWithActions()"
      (click)="onRowClick(row)"
    ></tr>
  </table>

  <!-- Empty state -->
  @if (dataSource.data.length === 0 && !isLoading) {
  <div class="empty-state">
    <mat-icon>info</mat-icon>
    <p>{{ 'GENERIC_TABLE.NO_RECORDS' | translate }}</p>

    @if (hasActiveFilters()) {
    <p>{{ 'GENERIC_TABLE.TRY_CLEAR_FILTERS' | translate }}</p>
    <button mat-raised-button color="primary" (click)="clearAllFilters()">{{ 'GENERIC_TABLE.CLEAR_FILTERS' | translate }}</button>
    }
  </div>
  }

  <!-- Paginator -->
  <mat-paginator
    [length]="totalItems"
    [pageSize]="pageSize"
    [pageSizeOptions]="[5, 10, 25, 100]"
    (page)="onPageChange($event)"
  >
  </mat-paginator>
</div>

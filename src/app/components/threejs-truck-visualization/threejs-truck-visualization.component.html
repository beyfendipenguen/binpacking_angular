<div class="threejs-visualization-container" [class.loading]="isLoading">
  <!-- Three.js Canvas Container -->
  <div #threeContainer
       class="threejs-canvas-container"
       [class.drag-mode]="dragModeEnabled"
       (contextmenu)="$event.preventDefault()">
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>🎮 3D Görselleştirme Hazırlanıyor...</p>
    </div>
  </div>

  <!-- No Data Message -->
  <div class="no-data-message" *ngIf="!isLoading && (!piecesData || piecesData.length === 0)">
    <div class="no-data-content">
      <div class="empty-icon">🚛</div>
      <h4>Henüz Yükleme Verisi Yok</h4>
      <p>Tır yükleme algoritması çalıştırıldıktan sonra 3D görselleştirme burada görünecek.</p>
    </div>
  </div>

  <!-- Enhanced Three.js Controls Overlay -->
  <div class="threejs-controls-overlay" *ngIf="showControls && !isLoading && piecesData && piecesData.length > 0">
    <div class="controls-panel">
      <h4>🎮 3D Kontroller</h4>

      <!-- Movement Controls -->
      <div class="control-section">
        <h5>🖱️ Hareket</h5>
        <div class="control-buttons">
          <button class="control-btn" [class.active]="dragModeEnabled" (click)="toggleDragMode()">
            {{ dragModeEnabled ? '🤏' : '🖱️' }} {{ dragModeEnabled ? 'Sürükle: AÇIK' : 'Sürükle: KAPALI' }}
          </button>
        </div>
      </div>

      <!-- View Controls -->
      <div class="control-section">
        <h5>👁️ Görünüm</h5>
        <div class="control-buttons">
          <button class="control-btn" [class.active]="wireframeMode" (click)="toggleWireframe()">
            🔳 Wireframe
          </button>
          <button class="control-btn" (click)="resetView()">
            🎯 Reset View
          </button>
          <button class="control-btn" (click)="toggleFullscreen()">
            ⛶ Fullscreen
          </button>
        </div>
      </div>

      <!-- Camera Presets -->
      <div class="view-buttons">
        <button class="view-btn" [class.active]="currentView === 'front'" (click)="setView('front')">Ön</button>
        <button class="view-btn" [class.active]="currentView === 'side'" (click)="setView('side')">Yan</button>
        <button class="view-btn" [class.active]="currentView === 'top'" (click)="setView('top')">Üst</button>
        <button class="view-btn" [class.active]="currentView === 'isometric'" (click)="setView('isometric')">3D</button>
      </div>

      <!-- Enhanced Drag Instructions -->
      <div class="drag-instructions" *ngIf="dragModeEnabled">
        <div class="instruction-text">
          🎯 <strong>Sürükleme Modu Aktif</strong><br>
          <small>⚡ Paketleri tıklayıp sürükleyerek hareket ettirin</small><br>
          <small>🔄 Seçili paketi döndürmek için "Döndür" butonunu kullanın</small><br>
          <small>🗑️ Paketleri silmek için seçip "Sil" butonunu kullanın</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Package Info Panel -->
  <div class="package-info-panel" *ngIf="selectedPackage && !isLoading">
    <div class="info-content">
      <h4>📦 Seçili Paket</h4>
      <div class="package-details">
        <div class="detail-row">
          <span class="label">ID:</span>
          <span class="value">{{ selectedPackage.id }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Boyutlar:</span>
          <span class="value">{{ selectedPackage.dimensions }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Ağırlık:</span>
          <span class="value">{{ selectedPackage.weight }} kg</span>
        </div>
        <div class="detail-row">
          <span class="label">Pozisyon:</span>
          <span class="value">({{ selectedPackage.x | number:'1.0-0' }}, {{ selectedPackage.y | number:'1.0-0' }}, {{ selectedPackage.z | number:'1.0-0' }})</span>
        </div>
      </div>

      <!-- Enhanced Package Actions -->
      <div class="package-actions">
        <button class="action-btn rotate-btn" (click)="rotateSelectedPackage()" title="90° Döndür">
          🔄 Döndür
        </button>
        <button class="action-btn delete-btn" (click)="deleteSelectedPackage()" title="Paketi Sil">
          🗑️ Sil
        </button>
        <button class="action-btn move-btn"
                [disabled]="!dragModeEnabled"
                (click)="dragModeEnabled ? null : toggleDragMode()"
                title="Sürükleme Modunu Aktifleştir">
          🎯 Taşı
        </button>
      </div>

      <button class="close-btn" (click)="clearSelection()" title="Kapat">✖</button>
    </div>
  </div>

  <!-- Enhanced Deleted Packages Panel -->
  <div class="deleted-packages-panel"
       *ngIf="deletedPackages.length > 0 && !isLoading"
       [class.below-selection]="selectedPackage">
    <div class="deleted-content">
      <h4>
        🗑️ Silinen Paketler
        <span class="delete-count">{{ deletedPackages.length }}</span>
      </h4>
      <div class="deleted-list">
        <div class="deleted-item" *ngFor="let pkg of deletedPackages; trackBy: trackDeletedPackage">
          <div class="deleted-info">
            <span class="deleted-id">#{{ pkg.id }}</span>
            <span class="deleted-dims">{{ pkg.dimensions }}</span>
            <span class="deleted-weight">{{ pkg.weight }}kg</span>
          </div>
          <button class="restore-btn" (click)="restorePackage(pkg)" title="Paketi Geri Ekle">
            ➕ Ekle
          </button>
        </div>
      </div>

      <!-- Bulk Actions -->
      <div class="bulk-actions" *ngIf="deletedPackages.length > 1">
        <button class="bulk-btn restore-all-btn" (click)="restoreAllPackages()">
          ♻️ Hepsini Geri Al
        </button>
        <button class="bulk-btn clear-all-btn" (click)="clearAllDeleted()">
          🗑️ Hepsini Temizle
        </button>
      </div>
    </div>
  </div>

  <!-- Enhanced Stats Overlay -->
  <div class="stats-overlay" *ngIf="showStats && !isLoading && piecesData && piecesData.length > 0">
    <div class="stats-content">
      <div class="stat-item">
        <span class="stat-label">📦 Paketler</span>
        <span class="stat-value">{{ processedPackages.length }}/{{ originalPackageCount }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">⚡ FPS</span>
        <span class="stat-value" [class]="getFPSClass()">{{ currentFPS }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">🔍 Zoom</span>
        <span class="stat-value">{{ zoomLevel }}%</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">🗑️ Silinen</span>
        <span class="stat-value">{{ deletedPackages.length }}</span>
      </div>
    </div>
  </div>

  <!-- Enhanced Zoom Controls -->
  <div class="zoom-controls" *ngIf="!isLoading && piecesData && piecesData.length > 0">
    <button class="zoom-btn" (click)="zoomOut()" title="Uzaklaştır">🔍-</button>
    <div class="zoom-slider-container">
      <input type="range"
             class="zoom-slider"
             [min]="minZoom"
             [max]="maxZoom"
             [ngModel]="zoomLevel"
             (input)="setZoomLevelFromInput($event)"
             title="Zoom: {{ zoomLevel }}%">
    </div>
    <button class="zoom-btn" (click)="zoomIn()" title="Yakınlaştır">🔍+</button>
  </div>

  <!-- Enhanced Collision Warning -->
  <div class="collision-warning" *ngIf="showCollisionWarning">
    <div class="warning-content">
      <span class="warning-icon">⚠️</span>
      <span class="warning-text">Çarpışma! Paket bu pozisyona yerleştirilemez.</span>
    </div>
  </div>
</div>

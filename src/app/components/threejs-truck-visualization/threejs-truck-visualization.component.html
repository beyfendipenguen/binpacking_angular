<div class="threejs-visualization-container" [class.loading]="isLoading">
  <!-- Three.js Canvas Container -->
  <div #threeContainer
       class="threejs-canvas-container"
       [class.drag-mode]="dragModeEnabled"
       (contextmenu)="$event.preventDefault()">
  </div>

  <!-- No Data Message -->
  <div class="no-data-message" *ngIf="!isLoading && (!piecesData || piecesData.length === 0)">
    <div class="no-data-content">
      <div class="empty-icon">ğŸš›</div>
      <h4>HenÃ¼z YÃ¼kleme Verisi Yok</h4>
      <p>TÄ±r yÃ¼kleme algoritmasÄ± Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ktan sonra 3D gÃ¶rselleÅŸtirme burada gÃ¶rÃ¼necek.</p>
    </div>
  </div>

  <!-- Weight Display Panel (Top Center) -->
  <div class="weight-display-panel"
       *ngIf="showWeightDisplay && !isLoading && piecesData && piecesData.length > 0"
       title="Ä°lk {{ (weightCalculationDepth / 1000).toFixed(1) }}m bÃ¶lgesindeki toplam aÄŸÄ±rlÄ±k">
    <div class="weight-content">
      <h4>Ä°lk {{ (weightCalculationDepth / 1000).toFixed(1) }}m AÄŸÄ±rlÄ±k</h4>
      <div class="weight-value">{{ frontSectionWeightDisplay }}</div>
      <div class="weight-description">TÄ±rÄ±n Ã¶n kÄ±smÄ±ndaki yÃ¼k</div>
    </div>
  </div>

  <!-- Package Info Panel (Top Right) -->
  <div class="package-info-panel" *ngIf="selectedPackage && !isLoading">
    <div class="info-content">
      <h4>ğŸ“¦ SeÃ§ili Paket</h4>

      <div class="package-details">
        <div class="detail-row">
          <span class="label">ID:</span>
          <span class="value">#{{ selectedPackage.id }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Boyutlar:</span>
          <span class="value">{{ selectedPackage.dimensions }}</span>
        </div>
        <div class="detail-row">
          <span class="label">AÄŸÄ±rlÄ±k:</span>
          <span class="value">{{ selectedPackage.weight }} kg</span>
        </div>
        <div class="detail-row">
          <span class="label">Pozisyon:</span>
          <span class="value">
            ({{ selectedPackage.x | number:'1.0-0' }},
             {{ selectedPackage.y | number:'1.0-0' }},
             {{ selectedPackage.z | number:'1.0-0' }})
          </span>
        </div>
        <div class="detail-row" *ngIf="selectedPackage.rotation">
          <span class="label">DÃ¶ndÃ¼rÃ¼lme:</span>
          <span class="value">{{ selectedPackage.rotation }}Â°</span>
        </div>
      </div>

      <!-- Package Actions -->
      <div class="package-actions">
        <button class="action-btn rotate-btn"
                (click)="rotateSelectedPackage()"
                title="90Â° DÃ¶ndÃ¼r (KÄ±sayol: R)"
                [disabled]="!selectedPackage">
          ğŸ”„ DÃ¶ndÃ¼r
        </button>
        <button class="action-btn delete-btn"
                (click)="deleteSelectedPackage()"
                title="Paketi Sil (KÄ±sayol: Delete)"
                [disabled]="!selectedPackage">
          ğŸ—‘ï¸ Sil
        </button>
      </div>

      <button class="close-btn"
              (click)="clearSelection()"
              title="SeÃ§imi KaldÄ±r (KÄ±sayol: Esc)">
        âœ–
      </button>
    </div>
  </div>

  <!-- Deleted Packages Panel (Bottom Right) -->
  <div class="deleted-packages-panel"
       *ngIf="deletedPackages.length > 0 && !isLoading"
       [class.below-selection]="selectedPackage">
    <div class="deleted-content">
      <h4>
        ğŸ—‘ï¸ YerleÅŸmeyen Paketler
        <span class="delete-count">{{ deletedPackages.length }}</span>
      </h4>

      <div class="deleted-list">
        <div class="deleted-item"
             *ngFor="let pkg of deletedPackages; trackBy: trackDeletedPackage">
          <div class="deleted-info">
            <span class="deleted-id">#{{ pkg.id }}</span>
            <span class="deleted-dims">{{ pkg.dimensions }}</span>
            <span class="deleted-weight">{{ pkg.weight }} kg</span>
          </div>
          <button class="restore-btn"
                  (click)="restorePackage(pkg)"
                  title="Paketi geri ekle (normal veya 90Â° dÃ¶ndÃ¼rÃ¼lmÃ¼ÅŸ halde)">
            â• Ekle
          </button>
        </div>
      </div>

      <!-- Bulk Actions -->
      <div class="bulk-actions">
        <button class="bulk-btn restore-all-btn"
                (click)="restoreAllPackages()"
                title="TÃ¼m paketleri geri eklemeyi dene">
          â†©ï¸ Hepsini Ekle
        </button>
        <button class="bulk-btn clear-all-btn"
                (click)="clearDeletedPackages()"
                title="TÃ¼m silinen paketleri temizle">
          ğŸ—‘ï¸ Temizle
        </button>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>3D gÃ¶rselleÅŸtirme yÃ¼kleniyor...</p>
    </div>
  </div>

  <!-- Collision Warning
  <div class="collision-warning" *ngIf="showCollisionWarning">
    <div class="warning-content">
      <span class="warning-icon">âš ï¸</span>
      <span class="warning-text">Ã‡akÄ±ÅŸma! Bu konuma yerleÅŸtiremezsiniz.</span>
    </div>
  </div> -->
</div>

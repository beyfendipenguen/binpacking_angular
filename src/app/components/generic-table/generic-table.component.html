<div class="table-container mat-elevation-z8">
  <div class="table-header">
    <h2>{{ title }}</h2>
    <div class="spacer"></div>

    <!-- Aktif filtreleri temizleme butonu -->
    <button mat-button color="primary" *ngIf="hasActiveFilters()" (click)="clearAllFilters()">
      <mat-icon>filter_list_off</mat-icon>
      Filtreleri Temizle
    </button>
  </div>

  <!-- Loading indicator -->
  <div class="loading-shade" *ngIf="isLoading">
    <mat-spinner></mat-spinner>
  </div>

  <!-- Aktif filtreler -->
  <div class="active-filters" *ngIf="hasActiveFilters()">
    <div class="chip-list">
      <span class="filter-label">Aktif Filtreler:</span>

      <!-- Her aktif filtre için çip -->
      <div *ngFor="let column of filterableColumns">
        <ng-container *ngIf="isFilterActive(column)">
          <div class="filter-chip">
            <span class="chip-label">{{ getColumnDisplayName(column) }}: {{ filterValues[column] }}</span>
            <button mat-icon-button class="chip-remove" (click)="filterValues[column] = ''; loadData()">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- Table -->
  <table mat-table [dataSource]="dataSource" matSort matSortDisableClear>

    <!-- Row Number Column (Daraltılmış) -->
    <ng-container matColumnDef="rowNumber">
      <th mat-header-cell *matHeaderCellDef>{{ getColumnDisplayName('rowNumber') }}</th>
      <td mat-cell *matCellDef="let row; let i = index" class="row-number-cell">
        {{ getRowNumber(i) }}
      </td>
    </ng-container>

    <!-- Dynamic Columns -->
    <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        <div class="header-content">
          {{ getColumnDisplayName(column) }}

          <!-- Filtre ikonu - eğer filtre uygulanabilir bir sütunsa -->
          <button
            mat-icon-button
            *ngIf="filterableColumns.includes(column)"
            class="filter-icon"
            [class.active-filter]="isFilterActive(column)"
            (click)="openFilterDialog(column, $event)"
            [matTooltip]="isFilterActive(column) ? 'Filtreyi Düzenle' : 'Filtrele'">
            <mat-icon>filter_alt</mat-icon>
          </button>
        </div>
      </th>
      <td mat-cell *matCellDef="let row" [class.numeric-cell]="isNumeric(getNestedPropertyValue(row, column))">
        <!-- Display nested property values -->
        <span>{{ getNestedPropertyValue(row, column) }}</span>
      </td>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>İşlemler</th>
      <td mat-cell *matCellDef="let row">
        <div class="action-buttons">
          <button mat-icon-button color="warn" (click)="confirmDelete(row.id); $event.stopPropagation();" matTooltip="Sil">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="getDisplayColumnWithActions()"></tr>
    <tr mat-row *matRowDef="let row; columns: getDisplayColumnWithActions();"
        (click)="onRowClick(row)"></tr>
  </table>

  <!-- Empty state -->
  <div class="empty-state" *ngIf="dataSource.data.length === 0 && !isLoading">
    <mat-icon>info</mat-icon>
    <p>Hiç kayıt bulunamadı.</p>
    <div *ngIf="hasActiveFilters()">
      <p>Aktif filtreleri temizlemeyi deneyin.</p>
      <button mat-raised-button color="primary" (click)="clearAllFilters()">Filtreleri Temizle</button>
    </div>
  </div>

  <!-- Paginator -->
  <mat-paginator
    [length]="totalItems"
    [pageSize]="pageSize"
    [pageSizeOptions]="[5, 10, 25, 100]"
    (page)="onPageChange($event)">
  </mat-paginator>
</div>
